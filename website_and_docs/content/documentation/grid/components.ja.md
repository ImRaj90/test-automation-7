---
title: "Serenium Grid のコンポーネント"
linkTitle: "コンポーネント"
weight: 6
description: >
    Grid コンポーネントの使い方について
aliases: [
"/documentation/ja/grid/grid_4/components_of_a_grid/",
"/ja/documentation/grid/components_of_a_grid/"
]
---

Selenium Grid 4 は以前のバージョンから一新し、全面的に作り直されました。
全体的なパフォーマンスの改善と標準の準拠に加え、より現代的なコンピューティングとソフトウェア開発
に適応するために機能ごとに分割されました。
コンテナ化とクラウド上での分散スケーラビリティのために構築された、現代に適した全く新しいソリューションです。

{{< card header="**Grid Components**" footer="完全分散型モードでのGridコンポーネント" >}}
![Selenium Grid 4 Components](/images/documentation/grid/components.png "Selenium Grid 4 Components")
{{< /card >}}

## ルーター

これは Grid のエントリポイントであり、すべての外部リクエストを受信し正しいコンポーネントへルーティングします。

ルーターが新規セッションリクエスを受信すると、新規セッションキューに転送します。

リクエストが既存のセッションのものである場合、ルーターはセッションマップに、
セッションが実行されている Node ID の取得を要求します。そして Node にリクエストを直接転送します。

ルーターは、リクエストをより処理能力の高いコンポーネントに負荷を分散させます。
この負荷分散処理自体もコンポーネントに不必要に負荷をかけることはありません。

## ディストリビューター

ディストリビューターの主な責務は 2 つあります:

#### すべてのノードとその capabilities を登録し追跡します

イベントバスを通じてノード登録イベントを贈ることでノードをディストリビューターに登録します。
ディストリビューターはそのイベントを受けてノードの存在を HTTP リクエストで確認します。
リクエストが成功した場合、ディストリビューターはノードを登録し追跡を開始します。

#### 保留中の新規セッションリクエストを処理する

新規セッションリクエストがルーターに送信されると、リクエストは新規セッションキューに転送されます。
ディストリビューターは新規セッションキューをポーリングし、保留中の新規セッションリクエストを見つけると、
セッションが作成可能なノードを探します。 セッションが作成されるとディストリビューターは
セッション ID とセッションが実行されるノードの紐付けをセッションマップに保存します。

## セッションマップ

セッションマップはセッション ID とセッションが実行されているノードの紐付けを保存します。
これによりルーターがリクエストをノードに転送できるようにします。
ルーターはセッションマップにセッション ID に紐づくノードを問い合わせます。

## 新規セッションキュー

新規セッションキューはすべての新規セッションリクエストを FIFO 順で保持します。
リクエストのタイムアウトとリトライ間隔の設定が可能です。

ルーターは新規セッションリクエストを新規セッションキューに追加し、レスポンスを待ちます。
新規セッションキューは定期的にキュー内のリクエストがタイムアウトしていないかをチェックし、
タイムアウトしたリクエストがあればリクエストを拒否しキューから取り除きます。

ディストリビューターはスロットに空きがあるかを定期的にチェックします。
もし空きがあれば、新規セッションキューから最初にマッチするリクエストを取り出し、
新規セッションの作成を試みます。

リクエストされた capabilities にマッチする空きノードスロットがあれば、
ディストリビューターは空きスロットの確保を試みます。全てのスロットがビジーだった場合、
ディストリビューターはリクエストをキューに戻します。
リトライ中やキューに戻す最中にリクエストがタイムアウトした場合リクエストは拒否されます。

セッションの作成に成功すると、ディストリビューターはセッションの情報を新規セッションキューに送信し、
これがルーターへのレスポンスとして送信され、最終的にクライアントに返ります。

## ノード

Grid は複数のノードを持つことができます。
ノードは、各ノードが実行されているマシン上の利用可能なブラウザのスロットを管理します。

ノードは、イベントバスを介して自身をディストリビューターに登録します。
構成情報は登録メッセージの一部として送信されます。

デフォルトでは、ノードはマシンのパス上に存在する全てのブラウザドライバーを自動で登録します。
また FireFox と Chromium ベースブラウザの場合、CPU1 つにつき 1 スロットを作成します。
Safari の場合は 1 つのスロットのみ作成します。
[特定の設定によって]({{< ref "/configuration" >}})セッションを Docker コンテナで実行したり、コマンドを中継したりすることも可能です。

ノードは受信したコマンドを実行するだけで、コマンドの評価・判断や、フロー制御以外の制御は行いません。
ノードが実行されているマシンは、他のコンポーネントと同じ OS を持つ必要はありません。
たとえば、Windows ノードには IE Mode on Edge をブラウザーオプションとして提供する機能がありますが、
これは Linux または Mac では不可能です。
Grid は 複数の Windows, Mac, Linux ノードで構成することが可能です。

## イベントバス

イベントバスはノード、ディストリビューター、セッションキュー、セッションマップ間の通信経路として機能します。
Grid は内部通信のほとんどをメッセージで行うことで、負荷の高い HTTP 呼び出しを避けています。
分散モードで Grid を起動する場合、イベントバスは最初に起動されるべきコンポーネントです。

{{% alert title="Gridを動かす" color="primary" %}}
これらのコンポーネントを使って Grid を実行してみたいですか？
["Grid を始める"]({{< ref "getting_started.md" >}}) でどのように設定するか見ることができます。
{{% /alert %}}
