---
title: "理解常见的异常"
linkTitle: "异常"
weight: 2
description: >
  如何处理Selenium代码中的各种问题.
---

## 无效选择器的异常 (Invalid Selector Exception)

某些时候难以获得正确的CSS以及XPath选择器.

### 潜在原因

您尝试使用的CSS或XPath选择器包含无效字符或无效查询.

### 可行方案

通过验证器服务运行选择器:
* [CSS 验证器](http://csslint.net/)
* [xPath 验证器](http://www.freeformatter.com/xpath-tester.html)

或者使用浏览器扩展程序来获取已知的良好值:
* [SelectorsHub](https://selectorshub.com/selectorshub/)

## 没有这样元素的异常 (No Such Element Exception)

在您尝试找到该元素的当前时刻无法定位元素.

### 潜在原因

* 您在错误的位置寻找元素 (也许以前的操作不成功).
* 您在错误的时间寻找元素 (该元素尚未显示在 DOM 中)
* 自您编写代码以来定位器已变更

### 可行方案

* 确保您位于期望的页面上, 并且代码中的前置操作已正确完成
* 确保您使用的是正确的 [等待策略]({{< ref "/documentation/webdriver/waits" >}})
* 使用浏览器的devtools控制台更新定位器或使用浏览器扩展程序，例如:
  * [SelectorsHub](https://selectorshub.com/selectorshub/)

## 过时元素引用的异常 (Stale Element Reference Exception)

元素先前的定位会过时，
导致当前无法访问.
元素不会自动重新定位;
驱动程序为元素创建引用ID，
并且有一个特定的位置，以期在 DOM 中找到.
如果在当前 DOM 中找不到元素,
任何使用该元素的操作都将导致此异常.

### 常见因素

以下情况可能发生此异常:

* 您已刷新页面，或者页面的 DOM 已动态更改.
* 您已导航到其他页面.
* 您已切换到另一个窗口，或者进入/移出某个frame/iframe.

### 常见方案

**DOM已变更**

当页面刷新或页面上的项目各处移动时,
页面上仍然有一个具有所需定位器的元素,
它只是不再被正在使用的元素对象访问,
并且必须重新定位该元素才能再次使用.
这往往通过以下两种方式之一完成:

* 每次使用时, 始终重新定位元素.
虽然可能, 但元素在定位和使用元素之间的微秒内过时的可能性很小.
缺点是这并非最有效的方法, 
特别是在远程网格上运行时.

* 将 Web 元素与存储定位器的另一个对象包装在一起，
并缓存位于Selenium元素.
对此包装的对象执行操作时,
您可以尝试使用缓存的对象(若之前找到),
如果其已过时, 则异常可以捕获元素,
使用存储的定位器重新定位元素, 并重试该方法.
这更有效, 但如果您使用的定位器可能会导致问题,
在页面更改后引用不同的元素(而不是您想要的元素).

**上下文已变更**

元素对象是为给定上下文存储的, 
因此, 如果您移动到其他上下文 —
就像不同的窗口或不同的frame或iframe一样 — 元素引用将仍然有效,
但暂时无法访问. 在这种情况下,
它不会帮助重新定位元素, 因为它在当前上下文中不存在.
要解决此问题, 您需要确保在使用元素之前切换回正确的上下文. 

**页面已变更**

这种情况是指您不仅更改了上下文, 还导航到了另一个页面, 
并破坏了元素所在的上下文.
您不能只是将其从当前上下文中重新定位,
并且您无法切换回有效的活动上下文.
如果这是原因, 则对于您的错误, 您必须导航回正确的位置并重新定位它.
